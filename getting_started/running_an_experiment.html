<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Running an Experiment &mdash; audiozen  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=9d25a2f2" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Logging and Visualization" href="logging_and_visualization.html" />
    <link rel="prev" title="Prerequisites and Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            audiozen
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Prerequisites and Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running an Experiment</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging_and_visualization.html">Logging and Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="project_structure.html">Project Structure</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/experiment_arguments.html">Experiment arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/trainer.html">Trainer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/conduct.html">Code of Conduct</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">audiozen</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Running an Experiment</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/haoxiangsnr/audiozen/blob/main/docs/source/getting_started/running_an_experiment.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="running-an-experiment">
<h1>Running an Experiment<a class="headerlink" href="#running-an-experiment" title="Link to this heading"></a></h1>
<p>In Spiking-FullSubNet, we adopt a <code class="docutils literal notranslate"><span class="pre">recipes/&lt;dataset&gt;/&lt;model&gt;</span></code> directory structure. For example, let us entry to the directory <code class="docutils literal notranslate"><span class="pre">recipes/intel_ndns/</span></code>. The corresponding dataset is the Intel Neuromorphic DNS Challenge dataset. Please refer to <a class="reference external" href="https://github.com/IntelLabs/IntelNeuromorphicDNSChallenge#dataset">Intel Neuromorphic DNS Challenge Datasets</a> for preparing the dataset.</p>
<p>To run an experiment of a model, we first go to a model directory. For example, we can entry to the directory <code class="docutils literal notranslate"><span class="pre">recipes/intel_ndns/spiking_fullsubnet/</span></code> to run an experiment of the <code class="docutils literal notranslate"><span class="pre">spiking_fullsubnet</span></code> model.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>recipes/intel_ndns/spiking_fullsubnet/
</pre></div>
</div>
<p>In this <code class="docutils literal notranslate"><span class="pre">&lt;model&gt;</span></code> directory, we have an entry file <code class="docutils literal notranslate"><span class="pre">run.py</span></code>, dataloaders, and some model directories. We use HugoingFace Accelerate to start an experiment. Don’t worry if you are not familiar with Accelerate. It will help you to run an parallel experiment easily. Please refer to <a class="reference external" href="https://huggingface.co/docs/accelerate/">HuggingFace Accelerate</a> for more details.</p>
<p>First, we need to configuration the GPU usage. Accelerate provides a CLI tool that unifies all launchers, so you only have to remember one command. To use it, run a quick configuration setup first on your machine and answer the questions:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>accelerate<span class="w"> </span>config
</pre></div>
</div>
<p>Then, we can use the following command to train the <code class="docutils literal notranslate"><span class="pre">spiking_fullsubnet</span></code> model using configurations in <code class="docutils literal notranslate"><span class="pre">baseline_m.toml</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>accelerate<span class="w"> </span>launch<span class="w"> </span>run.py<span class="w"> </span>-C<span class="w"> </span>baseline_m.toml<span class="w"> </span>-M<span class="w"> </span>train
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Alternatively, if you don’t want to use the CLI tool, you may use explicit arguments to <a class="reference external" href="https://huggingface.co/docs/accelerate/package_reference/cli#accelerate-env">specify the GPU usage</a>. For example: <code class="docutils literal notranslate"><span class="pre">accelerate</span> <span class="pre">launch</span> <span class="pre">--multi_gpu</span> <span class="pre">--num_processes=6</span> <span class="pre">--gpu_ids</span> <span class="pre">0,1,2,3,4,5</span> <span class="pre">--main_process_port</span> <span class="pre">46524</span> <span class="pre">--main_process_ip</span> <span class="pre">127.0.0.1</span> <span class="pre">run.py</span> <span class="pre">-C</span> <span class="pre">baseline_m.toml</span></code></p>
</div>
<p>You’ve initiated an experiment. Please note that the following sections, as well as additional pages, may not be optimally structured at the moment, resembling more closely the format of API documentation. This might require some technical proficiency to navigate effectively. Don’t worry, we will provide more examples later.</p>
<section id="entry-file-run-py">
<h2>Entry file <code class="docutils literal notranslate"><span class="pre">run.py</span></code><a class="headerlink" href="#entry-file-run-py" title="Link to this heading"></a></h2>
<p>If you are interested in inference and resume training, you may want to know how to use the entry file <code class="docutils literal notranslate"><span class="pre">run.py</span></code>. In this section, we will introduce the usage of <code class="docutils literal notranslate"><span class="pre">run.py</span></code>.</p>
<p>In each <code class="docutils literal notranslate"><span class="pre">&lt;model&gt;</span></code> directory, we have an entry file <code class="docutils literal notranslate"><span class="pre">run.py</span></code>, dataloaders, and some model directories. We use HuggingFace Accelerate to start an experiment. Please refer to <a class="reference external" href="https://huggingface.co/docs/accelerate/">HuggingFace Accelerate</a> for more details.</p>
<p><code class="docutils literal notranslate"><span class="pre">run.py</span></code> supports the following parameters:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-C</span></code> / <code class="docutils literal notranslate"><span class="pre">--configuration</span></code></p></td>
<td><p>The configuration file (<code class="docutils literal notranslate"><span class="pre">*.toml</span></code>) for the experiment.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-M</span></code> / <code class="docutils literal notranslate"><span class="pre">--mode</span></code></p></td>
<td><p>The mode of the experiment. It can be <code class="docutils literal notranslate"><span class="pre">train</span></code>, <code class="docutils literal notranslate"><span class="pre">validate</span></code>, <code class="docutils literal notranslate"><span class="pre">test</span></code>, <code class="docutils literal notranslate"><span class="pre">predict</span></code>, or <code class="docutils literal notranslate"><span class="pre">finetune</span></code> or a combination of them.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">train</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-R</span></code> / <code class="docutils literal notranslate"><span class="pre">--resume</span></code></p></td>
<td><p>Resume the experiment from the latest checkpoint.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">False</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--ckpt_path</span></code></p></td>
<td><p>The checkpoint path for test. It can be <code class="docutils literal notranslate"><span class="pre">best</span></code>, <code class="docutils literal notranslate"><span class="pre">latest</span></code>, or a path to a checkpoint file.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">latest</span></code></p></td>
</tr>
</tbody>
</table>
<p>See more details in <code class="docutils literal notranslate"><span class="pre">recipes/intel_ndns/spiking_fullsubnet/run.py</span></code>.</p>
<p>After a suspended experiment, we can resume training (using <code class="docutils literal notranslate"><span class="pre">-R</span></code> or <code class="docutils literal notranslate"><span class="pre">--resume</span></code>) from the last checkpoint:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>accelerate<span class="w"> </span>launch<span class="w"> </span>run.py
<span class="w">    </span>-C<span class="w"> </span>baseline_m_cumulative_laplace_norm.toml
<span class="w">    </span>--M<span class="w"> </span>train
<span class="w">    </span>-R
</pre></div>
</div>
<p>Using “best” epoch to test the model performance on the test dataset:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>accelerate<span class="w"> </span>launch<span class="w"> </span>run.py
<span class="w">    </span>-C<span class="w"> </span>baseline_m_cumulative_laplace_norm.toml
<span class="w">    </span>--M<span class="w"> </span><span class="nb">test</span>
<span class="w">    </span>--ckpt_path<span class="w"> </span>best
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Prerequisites and Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="logging_and_visualization.html" class="btn btn-neutral float-right" title="Logging and Visualization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, HAO Xiang.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>